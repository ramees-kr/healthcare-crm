<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Customer Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* Ensure invalid feedback is displayed */
        .invalid-feedback { display: block; }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 th:text="${customer.id} != null ? 'Edit Customer' : 'Add Customer'"></h2>
    <div class="card">
        <div class="card-body">
            <form th:action="${customer.id} != null ? '/admin/customers/update/' + ${customer.id} : '/admin/customers/add'"
                  th:object="${customer}"
                  method="post"
                  novalidate> <input type="hidden" th:field="*{id}">

                <div class="mb-3">
                    <label for="name" class="form-label">Name:</label>
                    <input type="text" id="name" class="form-control"
                           th:field="*{name}"
                           th:classappend="${#fields.hasErrors('name')} ? 'is-invalid' : ''"
                           required> <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">
                    Name Error </div>
                </div>

                <div class="mb-3">
                    <label for="age" class="form-label">Age:</label>
                    <input type="number" id="age" class="form-control"
                           th:field="*{age}"
                           th:classappend="${#fields.hasErrors('age')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('age')}" th:errors="*{age}">
                        Age Error
                    </div>
                </div>

                <div class="mb-3">
                    <label for="gender" class="form-label">Gender:</label>
                    <select id="gender" class="form-select"  th:field="*{gender}"
                            th:classappend="${#fields.hasErrors('gender')} ? 'is-invalid' : ''"
                            required>
                        <option value="">Select</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}">
                        Gender Error
                    </div>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">Email:</label>
                    <input type="email" id="email" class="form-control"
                           th:field="*{email}"
                           th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">
                        Email Error
                    </div>
                    <div class="text-danger" th:if="${error != null and error.contains('Email')}" th:text="${error}">
                        Persistence Error
                    </div>
                </div>

                <div class="mb-3">
                    <label for="medicalHistory" class="form-label">Medical History:</label>
                    <textarea id="medicalHistory" class="form-control"
                              th:field="*{medicalHistory}"
                              th:classappend="${#fields.hasErrors('medicalHistory')} ? 'is-invalid' : ''"
                              required></textarea>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('medicalHistory')}" th:errors="*{medicalHistory}">
                        Medical History Error
                    </div>
                </div>

                <div class="mb-3">
                    <label for="contactDetails" class="form-label">Contact Details:</label>
                    <input type="text" id="contactDetails" class="form-control"
                           th:field="*{contactDetails}"
                           th:classappend="${#fields.hasErrors('contactDetails')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('contactDetails')}" th:errors="*{contactDetails}">
                        Contact Details Error
                    </div>
                </div>

                <h3>Insurance Details</h3>
                <div th:if="${#fields.hasErrors('insurance')}" class="alert alert-danger" role="alert">
                    Please correct errors in the insurance section. </div>

                <input type="hidden" th:field="*{insurance.id}"> <div class="mb-3">
                    <label for="insuranceProvider" class="form-label">Provider:</label>
                    <input type="text" id="insuranceProvider" class="form-control"
                           th:field="*{insurance.provider}" th:classappend="${#fields.hasErrors('insurance.provider')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('insurance.provider')}" th:errors="*{insurance.provider}">
                        Provider Error
                    </div>
                </div>
                <div class="mb-3">
                    <label for="insurancePolicyNumber" class="form-label">Policy Number:</label>
                    <input type="text" id="insurancePolicyNumber" class="form-control"
                           th:field="*{insurance.policyNumber}" th:classappend="${#fields.hasErrors('insurance.policyNumber')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('insurance.policyNumber')}" th:errors="*{insurance.policyNumber}">
                        Policy Number Error
                    </div>
                </div>
                <div class="mb-3">
                    <label for="insuranceCoverageDetails" class="form-label">Coverage Details:</label>
                    <textarea id="insuranceCoverageDetails" class="form-control"
                              th:field="*{insurance.coverageDetails}" th:classappend="${#fields.hasErrors('insurance.coverageDetails')} ? 'is-invalid' : ''"
                              required></textarea>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('insurance.coverageDetails')}" th:errors="*{insurance.coverageDetails}">
                        Coverage Details Error
                    </div>
                </div>
                <div class="mb-3">
                    <label for="insuranceExpiryDate" class="form-label">Expiry Date:</label>
                    <input type="datetime-local" id="insuranceExpiryDate" class="form-control"
                           th:field="*{insurance.expiryDate}" th:classappend="${#fields.hasErrors('insurance.expiryDate')} ? 'is-invalid' : ''"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('insurance.expiryDate')}" th:errors="*{insurance.expiryDate}">
                        Expiry Date Error
                    </div>
                </div>

                <span style="color: red;" th:if="${error != null and !error.contains('Email')}" th:text="${error}"></span>

                <button type="submit" class="btn btn-success">Save</button>
                <a th:href="@{/admin/customers}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>